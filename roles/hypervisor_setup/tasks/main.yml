---

- name: Install Packages (yum)
  yum :
    name: "{{ item }}"
    state: latest
  with_items: "{{ hypervisor_packages }}"
  when: ansible_distribution == 'Red Hat Enterprise Linux' or ansible_distribution == 'CentOS' 
  become: true
  no_log: true

- name: Install Packages (dnf)
  dnf :
    name: "{{ item }}"
    state: latest
  with_items: "{{ hypervisor_packages }}"
  when: ansible_distribution == 'Fedora' 
  become: true
  no_log: true

- name: Setup Network Manager (to use dnsmasq instead of resolve.conf)
  ini_file:
    dest: /etc/NetworkManager/NetworkManager.conf
    section: main
    option: dns
    value: dnsmasq
    backup: yes
  register: ini_updates
  become: true

- name: Restart NetworkManager (enable DNS changes)
  service:
    name: NetworkManager
    state: restarted
  become: true
  when: ini_updates.changed
